{
    "displayName": "brittrock_hf",
    "jobSpec": {
        "workerPoolSpecs": [
            {
                "machineSpec": {
                    "machineType": "a3-megagpu-8g",
                    "acceleratorType": "NVIDIA_H100_MEGA_80GB",
                    "acceleratorCount": 8,
                    "reservationAffinity": {
                        "reservationAffinityType": "SPECIFIC_RESERVATION",
                        "key": "compute.googleapis.com/reservation-name",
                        "values": [
                            "projects/disco-sector-292704/zones/us-east4-a/reservations/snap-a3-mega-reservation"
                        ]
                    }
                },
                "replicaCount": "1",
                "containerSpec": {
                    "imageUri": "us-east5-docker.pkg.dev/google.com/vertex-training-dlexamples/britt-a3-mega/hf-vertex:latest",
                    "command": [
                        "sh",
                        "-c"
                    ],
                    "args": [
                        "git clone https://github.com/bvrockwell/hf-multi.git && chmod +x hf-multi/set_env.sh && ./hf-multi/set_env.sh && ./opt/conda/bin/accelerate config update --config_file $ACC_CONFIG && $LAUNCH_CMD"
                    ],
                    "env": [
                        {
                            "name": "LD_LIBRARY_PATH",
                            "value": "/usr/local/nvidia/lib64"
                        },
                        {
                            "name": "NODE_COUNT",
                            "value": "2"
                        },
                        {
                            "name": "ACC_CONFIG",
                            "value": "/hf-multi/2host_config.yaml"
                        }
                    ]
                }
            },
            {
                "machineSpec": {
                    "machineType": "a3-megagpu-8g",
                    "acceleratorType": "NVIDIA_H100_MEGA_80GB",
                    "acceleratorCount": 8,
                    "reservationAffinity": {
                        "reservationAffinityType": "SPECIFIC_RESERVATION",
                        "key": "compute.googleapis.com/reservation-name",
                        "values": [
                            "projects/disco-sector-292704/zones/us-east4-a/reservations/snap-a3-mega-reservation"
                        ]
                    }
                },
                "replicaCount": "1",
                "containerSpec": {
                    "imageUri": "us-east5-docker.pkg.dev/google.com/vertex-training-dlexamples/britt-a3-mega/hf-vertex:latest",
                    "command": [
                        "sh",
                        "-c"
                    ],
                    "args": [
                        "git clone https://github.com/bvrockwell/hf-multi.git && chmod +x hf-multi/set_env.sh && ./hf-multi/set_env.sh && ./opt/conda/bin/accelerate config update --config_file $ACC_CONFIG && echo $NEW_CMD && bash $NEW_CMD"
                    ],
                    "env": [
                        {
                            "name": "LD_LIBRARY_PATH",
                            "value": "/usr/local/nvidia/lib64"
                        },
                        {
                            "name": "NODE_COUNT",
                            "value": "2"
                        },
                        {
                            "name": "ACC_CONFIG",
                            "value": "/hf-multi/2host_config.yaml"
                        }
                    ]
                }
            }
        ],
        "enableWebAccess": true
    }
}